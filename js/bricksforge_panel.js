var brfPanel,bricksforgeData={panel:{timelines:[],cachedElements:{}}};"undefined"!=typeof gsap&&gsap.config({nullTargetWarn:!1});class BricksforgePanel{domContentLoadedEvent;currentUserRole;roles;hideElementsOnly=!1;timelines=[];splitTextInstances=[];timelineActions=[];templateVars;maxQueryNodes=25;matchMediaInstances=[];currentRunningEvent;fromPageTransitions=!1;constructor(e,t=!1,a=!1){t||(this.fromPageTransitions=a,e&&(this.domContentLoadedEvent=e),bricksforgeData||((bricksforgeData={}).panel={}),this.init())}async init(){this.setGlobals(),this.initTemplateVars(),"undefined"!=typeof BRFPANEL&&1==BRFPANEL.panelActivated&&(bricksIsFrontend||this.loadPanel(),setTimeout((()=>{this.renderPanel()}))),this.renderLogic(),this.hideElementsOnly&&this.handlePermissionSettings()}setGlobals(){if("undefined"!=typeof BRFPANEL){if(this.currentUserRole=BRFPANEL.currentUserRole,this.roles=BRFPANEL.permissions,this.roles&&Array.isArray(this.roles))for(let e of this.roles)e.value==this.currentUserRole&&(this.hideElementsOnly=e.permissions.hideOnly);bricksforgeData.panel.close=this.closePanel}}getCachedElement(e,t=!1,a=document){if(!bricksforgeData.panel.cachedElements[e]){let n;bricksIsFrontend?(n=t?a.querySelectorAll(e):document.querySelector(e),n.length>this.maxQueryNodes&&(n=Array.from(n).slice(0,this.maxQueryNodes))):n=this.getElementsUpTo(this.maxQueryNodes,e),bricksforgeData.panel.cachedElements[e]=n}return bricksforgeData.panel.cachedElements[e]}isValidSelector(e){try{return document.createDocumentFragment().querySelector(e),!0}catch(e){return!1}}initTemplateVars(){this.templateVars=["{eventType}","{eventTarget}","{eventTimestamp}","{eventCharCode}","{eventAltKey}","{eventCtrlKey}","{eventShiftKey}","{eventRepeat}","{eventKey}","{eventCode}","{eventLocation}","{eventButton}","{eventClientX}","{eventClientY}","{eventPageX}","{eventPageY}","{eventScreenX}","{eventScreenY}","{eventX}","{eventY}","{eventTouchCount}","{eventScale}","{eventRotation}","{eventTargetName}","{eventTargetType}","{eventTargetValue}","{eventTargetValidity}","{eventTargetChecked}","{eventTargetFilesCount}","{eventDataTransferTypesCount}","{eventDataTransferFilesCount}","{eventDataTransferText}","{windowScrollX}","{windowScrollY}","{windowInnerWidth}","{windowInnerHeight}","{windowOuterWidth}","{windowOuterHeight}","{eventTargetOffsetTop}","{eventTargetOffsetLeft}","{eventTargetOffsetWidth}","{eventTargetOffsetHeight}","{postId}"],bricksforgeData.panel.variables=this.templateVars}renderLogic(){document.addEventListener("click",(e=>{const t=e.target;t instanceof HTMLElement&&"BUTTON"==t.tagName&&t.parentNode&&"brf-render"==t.parentNode.getAttribute("controlkey")&&(e.preventDefault(),document.querySelector("li.reload-canvas").click())}))}closePanel(){let e=document.querySelector("#bricksforge-triggers .brf-triggers-container"),t=document.querySelector("#bricks-panel"),a=document.querySelector("#bricks-structure"),n=document.querySelector("#bricks-builder-iframe");e&&(e.style.bottom="-"+e.getAttribute("data-height"),e.style.opacity=0),bricksforgeData.panel.isOpen=!1,document.body.removeAttribute("data-brf-timeline-focus"),document.body.removeAttribute("data-brf-panel-open"),t&&(t.style.height="calc(100vh - 40px)"),a&&(a.style.height="calc(100vh - 40px)",a.removeAttribute("style"),document.querySelector(".brx-body").__vue_app__.config.globalProperties.$_state.showStructure=!0),n&&n.removeAttribute("style");const i=new URL(window.location.href);i.searchParams.delete("brf-panel"),i.searchParams.delete("brf-focus"),i.searchParams.delete("brf-page"),window.history.replaceState(null,null,i),document.dispatchEvent(new CustomEvent("brf-panel-close"))}loadPanel(){let e=document.createElement("div");e.setAttribute("id","bricksforge-triggers"),document.querySelector("#bricks-preview")&&document.querySelector("#bricks-preview").appendChild(e);let t=document.querySelector("#bricks-toolbar ul.group-wrapper.left"),a=document.createElement("li");a.classList.add("brf-panel"),a.setAttribute("data-balloon","Bricksforge Panel (Shortcut: CTRL + P)"),a.setAttribute("data-balloon-pos","bottom");let n=document.createElement("span");n.classList.add("bricks-svg-wrapper"),a.appendChild(n),t&&t.appendChild(a),setTimeout((()=>{document.querySelector("#bricksforge-triggers .brf-triggers-container")&&(document.querySelector("#bricksforge-triggers .brf-triggers-container").style.bottom="-"+document.querySelector("#bricksforge-triggers .brf-triggers-container").getAttribute("data-height"))}),500),a.addEventListener("click",(()=>{const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});let t=document.querySelector("#bricksforge-triggers .brf-triggers-container");if(t.style.bottom&&1==t.style.opacity){if(this.closePanel(),e["brf-panel"]){const e=new URL(window.location.href);e.searchParams.delete("brf-panel"),window.history.replaceState(null,null,e)}document.dispatchEvent(new CustomEvent("brf-panel-close"))}else if(t.style.bottom="-2px",t.style.opacity=1,document.body.setAttribute("data-brf-panel-open","true"),!e["brf-panel"]){const e=new URL(window.location.href);e.searchParams.set("brf-panel","1"),window.history.replaceState(null,null,e),bricksforgeData.panel.isOpen=!0,document.dispatchEvent(new CustomEvent("brf-panel-open"))}}))}handlePermissionSettings(){document.addEventListener("mousedown",(e=>{let t=e.target;t&&(t.matches("li.elements")||t.closest("li")&&t.closest("li").classList.contains("elements"))&&setTimeout((()=>{this.hideCategories()}),250)})),setTimeout((()=>{this.hideCategories()}),750)}hideCategories(){for(let e of document.querySelectorAll("#bricks-panel-elements-categories .category")){if(!(e.classList.contains("category-layout")||e.classList.contains("category-basic")||e.classList.contains("category-general")||e.classList.contains("category-media")||e.classList.contains("category-wordpress")||e.classList.contains("category-single"))){let t=e.querySelector(".sortable-wrapper").querySelectorAll("li");for(let e of t)e.setAttribute("style","display:block !important");return}let t=e.querySelector(".sortable-wrapper").querySelectorAll("li"),a=!0;for(let e of t)"none"!=getComputedStyle(e).display&&(a=!1);a&&(e.style.display="none")}}renderPanel(e=!1,t=[],a=!1,n=!1){if(!bricksIsFrontend&&!this.isPanelOpen())return;this.timelines.length>1&&(this.timelines=[]);const i="undefined"!=typeof BRFPANEL&&BRFPANEL.panel&&BRFPANEL.panel.length?BRFPANEL.panel[0]:null;if(!i){if(n){this.timelines=[],this.handleFromAnimations();for(let e of t)this.handleTimeline(e,!1,a);return}return}if(n){this.timelines=[],this.handleFromAnimations();for(let e of t)this.handleTimeline(e,!1,!0);return}const s=i.instances,r=BRFPANEL.panelNodes,o=!0===bricksIsFrontend,l=BRFPANEL&&BRFPANEL.postId?BRFPANEL.postId.toString():"";if(!e&&o&&s&&s.length>0||r&&r.nodes&&r.nodes.length>0){for(let e of s){if(e.disabled)continue;let t=this.checkInstanceConditions({data:e,trigger:e.selector||null,target:null});if(t&&"specificPages"===e.loadOnChoice&&e.loadOn&&""!==e.loadOn.trim()){e.loadOn.split(",").map((e=>e.trim())).includes(l)||(t=!1)}t&&this.handleInstance(e)}r&&this.handlePanelNodes(r)}let c=i.timelines;if(e&&(this.timelines=[],c=[t]),a){this.timelines=[],c=t;const e=document.querySelectorAll("path[data-original]");gsap.set(e,{morphSVG:(e,t)=>t.getAttribute("data-original")})}if(c&&c.length)if("undefined"!=typeof gsap){this.handleTimelineEventListeners(),this.handleFromAnimations();for(let t of c)if(!t.disabled){if(o&&t.loadOnChoice&&t.loadOn&&(""!==t.loadOn||0==t.loadOn.length)){if(this.shouldSkip(t))continue}if(t.matchMedia&&o){const n=gsap.matchMedia().add(t.matchMedia,(()=>{this.handleTimeline(t,e,a)}));this.matchMediaInstances.push(n)}else{if(this.fromPageTransitions&&this.timelineHas3DModel(t))return;this.handleTimeline(t,e,a)}}if("undefined"!=typeof ScrollTrigger){this.handleAnchorLinks();let e=0;this.isDesktop()||(e=2e3),setTimeout((()=>{ScrollTrigger.sort()}),e)}}else console.warn("Bricksforge Panel: Timelines found but GSAP is not loaded.")}timelineHas3DModel(e){return e.animations.some((e=>e.animate3DModel))}shouldSkip(e){if(!e)return!1;let t=!1;const a=BRFPANEL.postId.toString();switch(e.loadOnChoice){case"everywhere":if(e.loadOnExceptPages&&e.loadOnExceptPages.length>0){e.loadOnExceptPages.map((e=>e.toString())).includes(a)&&(t=!0)}if(!t&&e.loadOnExceptBricksTemplates&&e.loadOnExceptBricksTemplates.length>0){let a=BRFPANEL.activeTemplate.content;e.loadOnExceptBricksTemplates.includes(a)&&(t=!0)}break;case"specificPages":{let n=Array.isArray(e.loadOn)?e.loadOn:e.loadOn.split(",").map((e=>e.trim()));n=n.map((e=>"string"==typeof e?parseInt(e):e)),n.includes(parseInt(a))||(t=!0);break}case"bricksActiveTemplate":{if(!e.loadOnBricksTemplate)break;let a=BRFPANEL.activeTemplate.content;e.loadOnBricksTemplate.includes(a)||(t=!0);break}case"custom":e.loadOnCustom.split(",").map((e=>e.trim())).includes(a)||(t=!0);break}return t}handleFromAnimations(){if(bricksIsFrontend)return;const e=BRFPANEL.panel[0]?.timelines;if(e)for(let t of e)for(let e of t.animations)if("from"==e.method){let a=!!t.animateTrigger&&t.animateTrigger,n=t.triggerSelector?t.triggerSelector:"",i=e.selector;!0===a&&n&&(i=e.childSelector?this.getCachedElement(n+" "+e.childSelector,!0,document):this.getCachedElement(n,!0,document)),i=this.getElementsUpTo(this.maxQueryNodes,i),gsap.set(i,{clearProps:!0})}}getElementsUpTo(e,t,a=document.documentElement){("number"!=typeof e||!Number.isFinite(e)||e<=0||e>Number.MAX_SAFE_INTEGER)&&(e=1/0);const n=document.createNodeIterator(a,NodeFilter.SHOW_ELEMENT),i=[];let s;for(;i.length<e&&(s=n.nextNode());){let e=!1;t&&"string"==typeof t&&s?e=s.matches(t):Array.isArray(t)&&(e=t.includes(s)),e&&i.push(s)}return i}removeFoucClass(e){let t=0;e.classList.contains("brf-three-js")&&(t=200),setTimeout((()=>{e.classList.remove("brf-prevent-fouc")}),t)}handleAnchorLinks(){setTimeout((()=>{if(window.location.hash){let e=window.location.hash,t=document.querySelector(e);ScrollTrigger.refresh(),t&&"undefined"==typeof Lenis&&"undefined"==typeof ScrollSmoother&&t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}}),100)}wait(e){return new Promise((t=>setTimeout(t,e)))}handleTimelineEventListeners(){bricksIsFrontend&&this.handleSplitTextInstancesRefresh()}isDesktop(){return!/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}handleSplitTextInstancesRefresh(){if(!this.isDesktop())return;let e,t=window.innerWidth,a=window.innerHeight;window.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{const e=Math.abs(window.innerWidth-t),n=Math.abs(window.innerHeight-a);if(e>50||n>50){t=window.innerWidth,a=window.innerHeight;let e=this.splitTextInstances;if(!e)return;e.forEach((e=>{const t=e.data;t.revert(),t.split()})),this.refreshTimelines({onlySplitText:!0})}}),250)}))}refreshTimelines({onlySplitText:e=!1}={}){const t=BRFPANEL.panel[0].timelines;t&&(this.handleFromAnimations(),t.forEach((t=>{this.shouldSkip(t)||e&&!this.hasSplitTextAnimation(t)||this.handleTimeline(t,!1,!1)})))}hasSplitTextAnimation(e){const t=e.animations;return!!t&&t.some((e=>!0===e.splitText))}checkInstanceConditions(e){let t=e.data;if(!t.conditions||!t.conditions.length)return!0;let a=t.conditionsRelation?t.conditionsRelation:"and",n=[];for(let a of t.conditions)switch(a.type){case"elementNode":if(!a.elementNodeSelector||!a.elementNodeSelector||!a.elementNodeOption){n.push(!1);break}let t=document.querySelector(this.handleTemplateVars(a.elementNodeSelector,{event:e.event}));if(!t){n.push(!1);break}switch(a.elementNodeOption){case"class":if(!a.elementNodeValue){n.push(!1);break}if("has"==a.elementNodeOperator){if(t.classList.contains(this.handleTemplateVars(a.elementNodeValue,{event:e.event}))){n.push(!0);break}n.push(!1);break}if("notHas"==a.elementNodeOperator){if(t.classList.contains(this.handleTemplateVars(a.elementNodeValue,{event:e.event}))){n.push(!1);break}n.push(!0);break}break;case"attribute":if(!a.elementNodeValue){n.push(!1);break}if(!a.elementNodeAttribute){n.push(!1);break}if("has"==a.elementNodeOperator){if(t.getAttribute(this.handleTemplateVars(a.elementNodeAttribute,{event:e.event}))==this.handleTemplateVars(a.elementNodeValue,{event:e.event})){n.push(!0);break}n.push(!1);break}if("notHas"==a.elementNodeOperator){if(t.getAttribute(this.handleTemplateVars(a.elementNodeAttribute,{event:e.event}))!=this.handleTemplateVars(a.elementNodeValue,{event:e.event})){n.push(!0);break}n.push(!1);break}}break;case"localStorage":if(!a.localStorageKey||!a.localStorageOperator){n.push(!1);break}switch(a.localStorageOperator){case"exists":n.push(null!=localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"notExists":n.push(!localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"==":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))==this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case"!=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))!=this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case">":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case">=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})))}break;case"sessionStorage":if(!a.localStorageKey||!a.localStorageOperator){n.push(!1);break}switch(a.localStorageOperator){case"exists":n.push(null!=sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"notExists":n.push(!sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"==":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))==this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case"!=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))!=this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case">":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case">=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})))}break;case"custom":if(!a.customCondition){n.push(!1);break}let i=e.trigger?e.trigger:null,s=e.target?e.target:null,r=e.event?e.event:null,o=new Function("return ((trigger, target, event) => {return "+a.customCondition+"})")();if("function"!=typeof o){n.push(!1);break}n.push(!0===o(i,s,r))}if(!n.length)return!1;switch(a){case"and":return!n.includes(!1);case"or":return n.includes(!0);default:return!1}}async handleInstance(e){if(!e.event||!e.selector||!e.actions.length){if(!(e.selector||"pageLoad"==e.event||e.selector||"scrollPosition"==e.event||"scrollUp"==e.event||"scrollDown"==e.event||"visibilitychange"==e.event||"resize"==e.event||"sliderMove"==e.event||"sliderMoved"==e.event||"sliderVisible"==e.event||"sliderHidden"==e.event||"sliderClick"==e.event||"sliderResize"==e.event||"sliderResized"==e.event||"sliderDrag"==e.event||"sliderDragging"==e.event||"sliderDragged"==e.event||"sliderOverflow"==e.event||e.event.includes("wpgb")))return void console.warn("You try to use the Bricksforge Panel, but there are some informations missing. This warning appears for the instance: "+(e.name?e.name:"No Name"));e.selector="html"}let t,a=e.selector,n=!1,i=e.event,s=e.actions,r=!!e.delay&&e.delay;switch(r&&await this.wait(r),e.selectorType){case"exactly":default:a=document.querySelector(a);break;case"all":a=document.querySelectorAll(a),n=!0;break;case"siblings":a=document.querySelector(a).parentNode.children,n=!0;break;case"parent":a=document.querySelector(a).parentNode;break;case"children":a=document.querySelector(a).children,n=!0;break;case"closest":if(!e.closestValue)break;a=document.querySelector(a).closest(e.closestValue)}if(null==a&&"document"==e.selector&&(a=document),null==a&&"window"==e.selector&&(a=window),null!=a)for(let r of s){let l=r.action,c=this.getTargetElement(l.target,l.targetElement,a,e,null)[0];switch(l.value){case"followCursor":if(!!!l.forceHideWhenLeaves)break;n&&"object"==typeof a&&a.forEach((e=>{e.addEventListener("mouseleave",(e=>{c&&NodeList.prototype.isPrototypeOf(c)?c.forEach((e=>{e&&(e.style.visibility="hidden")})):c.style.visibility="hidden"}))}))}switch(i){case"scrollPosition":document.addEventListener("scroll",(t=>{if(e.consoleLog&&"event"==e.consoleLog&&console.log(t),!e.scrollPosition||!e.scrollPositionOperator)return;let n;switch(e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),e.scrollPositionOperator){case"==":default:n=window.scrollY==e.scrollPosition;break;case">":n=window.scrollY>e.scrollPosition;break;case"<":n=window.scrollY<e.scrollPosition;break;case">=":n=window.scrollY>=e.scrollPosition;break;case"<=":n=window.scrollY<=e.scrollPosition}n&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})}));break;case"scrollUp":var o=0;document.addEventListener("scroll",(t=>{var n=window.pageYOffset||document.documentElement.scrollTop;n<o&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),s.forEach((n=>{this.fireAction({action:n.action.value,selector:a,instance:e,actionData:n.action,event:t,actionDataRaw:n})}))),o=n<=0?0:n}),!1);break;case"scrollDown":o=0;document.addEventListener("scroll",(t=>{var n=window.scrollY||document.documentElement.scrollTop;n>o&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),s.forEach((n=>{this.fireAction({action:n.action.value,selector:a,instance:e,actionData:n.action,event:t,actionDataRaw:n})}))),o=n<=0?0:n}),!1);break;case"inViewport":if(!a)return;document.addEventListener("scroll",(t=>{if(e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),n)a.forEach((a=>{var n=a.getBoundingClientRect(),i=n.top,s=n.bottom;let o=e.inViewportVisibility?e.inViewportVisibility:"partially",l=e.inViewportVisibilityOffset?e.inViewportVisibilityOffset:0;("partially"==o?i<window.innerHeight-l&&s>=0:i>=0&&s<=window.innerHeight+l)&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}))}));else{var i=a.getBoundingClientRect(),s=i.top,o=i.bottom;let n=e.inViewportVisibility?e.inViewportVisibility:"partially",l=e.inViewportVisibilityOffset?e.inViewportVisibilityOffset:0;("partially"==n?s<window.innerHeight-l&&o>=0:s>=0&&o<=window.innerHeight+l)&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}))}}));break;case"notInViewport":if(!a)return;document.addEventListener("scroll",(t=>{if(e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),n)a.forEach((a=>{var n=a.getBoundingClientRect(),i=n.top,s=n.bottom;i<window.innerHeight&&s>=0||(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}))}));else{var i=a.getBoundingClientRect(),s=i.top,o=i.bottom;s<window.innerHeight&&o>=0||(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}))}}));break;case"pageLoad":this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:this.domContentLoadedEvent,actionDataRaw:r});break;case"visibilitychange":document.addEventListener("visibilitychange",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.visibilityState&&document.visibilityState==e.visibilityState&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})}));break;case"resize":window.addEventListener("resize",(t=>{if(e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.resizeDimension&&e.resizeOperator&&e.resizeValue)switch(e.resizeOperator){case"==":"width"==e.resizeDimension&&window.innerWidth==e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}),"height"==e.resizeDimension&&window.innerHeight==e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r});break;case">":"width"==e.resizeDimension&&window.innerWidth>e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}),"height"==e.resizeDimension&&window.innerHeight>e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r});break;case"<":"width"==e.resizeDimension&&window.innerWidth<e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}),"height"==e.resizeDimension&&window.innerHeight<e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r});break;case">=":"width"==e.resizeDimension&&window.innerWidth>=e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}),"height"==e.resizeDimension&&window.innerHeight>=e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r});break;case"<=":"width"==e.resizeDimension&&window.innerWidth<=e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r}),"height"==e.resizeDimension&&window.innerHeight<=e.resizeValue&&this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r});break;default:this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})}else this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})}));break;case"resizeObserver":if(!a)return;new ResizeObserver((t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})})).observe(a);break;case"mutationObserver":if(!a)return;if(n)a.forEach((t=>{let a=!!e.mutationObserverAttributes&&e.mutationObserverAttributes,n=!!e.mutationObserverChildList&&e.mutationObserverChildList,i=!!e.mutationObserverCharacterData&&e.mutationObserverCharacterData,s=!!e.mutationObserverSubTree&&e.mutationObserverSubTree;new MutationObserver((a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),this.fireAction({action:r.action.value,selector:t,instance:e,actionData:r.action,event:a,actionDataRaw:r})})).observe(t,{attributes:a,childList:n,characterData:i,subtree:s})}));else{let t=!!e.mutationObserverAttributes&&e.mutationObserverAttributes,n=!!e.mutationObserverChildList&&e.mutationObserverChildList,i=!!e.mutationObserverCharacterData&&e.mutationObserverCharacterData,s=!!e.mutationObserverSubTree&&e.mutationObserverSubTree;new MutationObserver((t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,actionData:r.action,event:t,actionDataRaw:r})})).observe(a,{attributes:t,childList:n,characterData:i,subtree:s})}break;case"sliderMove":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("move",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderMoved":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("moved",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderVisible":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("visible",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderHidden":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("hidden",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderClick":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("click",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderResize":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("resize",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderResized":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("resized",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderDrag":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("drag",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderDragging":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("dragging",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderDragged":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("dragged",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"sliderOverflow":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("overflow",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;case"wpgbFacetInit":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("init",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"wpgbFacetLoaded":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("loaded",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"wpgbFacetAppended":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("appended",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"wpgbFacetRefresh":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("refresh",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"wpgbFacetChange":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("change",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"wpgbFacetReset":if("undefined"==typeof WP_Grid_Builder||!WP_Grid_Builder.instances)break;Object.values(WP_Grid_Builder.instances).forEach((t=>{t.facets&&t.facets.on("reset",(t=>{this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}));break;case"custom":if(!e.customEventName)break;if(n){Array.prototype.forEach.call(a,(t=>{t.addEventListener(e.customEventName,(a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),e.preventDefault&&a.preventDefault(),e.stopPropagation&&a.stopPropagation(),this.fireAction({action:r.action.value,selector:t,instance:e,event:a,actionData:r.action,actionDataRaw:r})}))}));break}a.addEventListener(e.customEventName,(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}));break;default:if(n){Array.prototype.forEach.call(a,(t=>{t.addEventListener(i,(a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),e.preventDefault&&a.preventDefault(),e.stopPropagation&&a.stopPropagation(),this.fireAction({action:r.action.value,selector:t,instance:e,event:a,actionData:r.action,actionDataRaw:r})}))}));break}a.addEventListener(i,(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),this.fireAction({action:r.action.value,selector:a,instance:e,event:t,actionData:r.action,actionDataRaw:r})}))}}else console.warn("Bricksforge Panel: Selector not found: "+e.selector)}handleTemplateVars(e,t){if(!e)return e;if(!e.includes("{"))return e;[{name:"{eventType}",value:t.event?t.event.type:""},{name:"{eventTarget}",value:t.event&&t.event.target?t.event.target.toString():""},{name:"{eventTimestamp}",value:t.event?t.event.timeStamp:""},{name:"{eventCharCode}",value:t.event&&"keypress"===t.event.type?t.event.charCode:""},{name:"{eventAltKey}",value:t.event?t.event.altKey:""},{name:"{eventCtrlKey}",value:t.event?t.event.ctrlKey:""},{name:"{eventShiftKey}",value:t.event?t.event.shiftKey:""},{name:"{eventRepeat}",value:t.event?t.event.repeat:""},{name:"{eventKey}",value:t.event?t.event.key:""},{name:"{eventCode}",value:t.event?t.event.code:""},{name:"{eventLocation}",value:!t.event||"keydown"!==t.event.type&&"keyup"!==t.event.type?"":t.event.location},{name:"{eventButton}",value:t.event?t.event.button:""},{name:"{eventClientX}",value:t.event?t.event.clientX:""},{name:"{eventClientY}",value:t.event?t.event.clientY:""},{name:"{eventPageX}",value:t.event?t.event.pageX:""},{name:"{eventPageY}",value:t.event?t.event.pageY:""},{name:"{eventScreenX}",value:t.event?t.event.screenX:""},{name:"{eventScreenY}",value:t.event?t.event.screenY:""},{name:"{eventX}",value:t.event?t.event.x:""},{name:"{eventY}",value:t.event?t.event.y:""},{name:"{eventTouchCount}",value:t.event&&t.event.touches?t.event.touches.length:""},{name:"{eventScale}",value:t.event&&t.event.scale?t.event.scale:""},{name:"{eventRotation}",value:t.event&&t.event.rotation?t.event.rotation:""},{name:"{eventTargetName}",value:t.event&&t.event.target?t.event.target.name:""},{name:"{eventTargetType}",value:t.event&&t.event.target?t.event.target.type:""},{name:"{eventTargetValue}",value:t.event&&t.event.target?t.event.target.value:""},{name:"{eventTargetValidity}",value:t.event&&t.event.target&&t.event.target.validity?t.event.target.validity.valid?"valid":"invalid":""},{name:"{eventTargetChecked}",value:t.event&&t.event.target&&("checkbox"===t.event.target.type||"radio"===t.event.target.type)?t.event.target.checked:""},{name:"{eventTargetFilesCount}",value:t.event&&t.event.target&&"file"===t.event.target.type&&t.event.target.files?t.event.target.files.length:""},{name:"{eventDataTransferTypesCount}",value:t.event&&t.event.dataTransfer?t.event.dataTransfer.types.length:""},{name:"{eventDataTransferFilesCount}",value:t.event&&t.event.dataTransfer?t.event.dataTransfer.files.length:""},{name:"{eventDataTransferText}",value:t.event&&t.event.dataTransfer&&t.event.dataTransfer.types.indexOf("text/plain")>=0?t.event.dataTransfer.getData("text/plain"):""},{name:"{windowScrollX}",value:window.scrollX},{name:"{windowScrollY}",value:window.scrollY},{name:"{windowInnerWidth}",value:window.innerWidth},{name:"{windowInnerHeight}",value:window.innerHeight},{name:"{windowOuterWidth}",value:window.outerWidth},{name:"{windowOuterHeight}",value:window.outerHeight},{name:"{eventTargetOffsetTop}",value:t.event&&t.event.target?t.event.target.offsetTop:""},{name:"{eventTargetOffsetLeft}",value:t.event&&t.event.target?t.event.target.offsetLeft:""},{name:"{eventTargetOffsetWidth}",value:t.event&&t.event.target?t.event.target.offsetWidth:""},{name:"{eventTargetOffsetHeight}",value:t.event&&t.event.target?t.event.target.offsetHeight:""},{name:"{postId}",value:bricksData?bricksData.postId:""}].forEach((t=>{e=e.replace(t.name,t.value)}));let a=["formField","formData"].some((t=>e.includes(`{${t}:`)));e.includes("{")&&e.includes(":")&&a&&(e=e.replace(/{(.*?):(.*?)}/g,((e,t,a)=>{let n="";switch(t){case"formField":n=this.getFormFieldValue(a);break;case"formData":n=this.getFormData(a)}return n})));const n=e.match(/{event:(.*?)}/);if(n){const a=n[1].split(/\.|:/).reduce(((e,t)=>e instanceof HTMLElement&&"value"===t?e.value:e&&void 0!==e[t]?e[t]:void 0),t.event);void 0!==a&&(e=e.replace(n[0],a))}return e}getFormFieldValue(e){let t=document.querySelector(`[name="${e}"]`);return t?"checkbox"===t.type||"radio"===t.type?t.checked:t.value:""}getFormData(e){let t=document.querySelector("#"+e);if(!t)return"";let a=new FormData(t),n={};for(let[e,t]of a.entries())n[e]=t;return JSON.stringify(n)}getTargetElement(e,t,a,n,i){let s=!1;switch(t&&(t=this.handleTemplateVars(t,{event:i})),e){case"same":if(!a||!i)break;e=i.target;break;case"triggered":e="triggered";break;case"all":if(!a)break;e=document.querySelectorAll(n.selector),s=!0;break;case"siblings":if(!a||!i)break;e=i.target.parentNode.children,s=!0;break;case"parent":if(!a||!i)break;e=i.target.parentNode;break;case"children":if(!a||!i)break;e=i.target.children,s=!0;break;case"closest":if(!a)break;if(!e)break;if(!i)break;e=i.target.closest(t);break;case"querySelector":if(!a||!i)break;e=i.target.closest(n.selector).querySelector(t);break;case"custom":e=document.querySelector(t);break;case"customAll":e=document.querySelectorAll(t),s=!0;break;case"window":e=window;break;default:if(!a)break;e=document.querySelector(n.selector)}return[e,s]}async fireAction(e){let t=e.instance,a=e.action,n=e.actionData,i=e.selector,s=!!e.event&&e.event.target,r=e.actionDataRaw,o=!!n.delay&&n.delay,l=!!e.isNode&&e.isNode;const c=this.getTargetElement(n.target,n.targetElement,i,t,e.event);let d=c[0];"same"!=n.target&&"triggered"!=n.target||"inViewport"!=t.event&&"notInViewport"!=t.event||(d=i);let u=c[1];if(!a||!i)return;if(!l&&r.conditions&&r.conditions.length>0){if(!this.checkInstanceConditions({data:r,trigger:i,target:d,event:e.event}))return}o&&await this.wait(o);let g=n.except&&"none"!=n.except,p=!!n.exceptSelector&&n.exceptSelector,h=s;if(g&&!1!==p&&s&&s!=document.querySelector(p)&&(h=s.closest(p)),"triggered"==d)if(s&&s!=document.querySelector(t.selector))if(t.x){let f=t?.event?.settings?.targetElement;f&&(d=document.querySelector(f))}else d=s.closest(t.selector);else if(t.x){let m=t?.event?.settings?.targetElement;m&&(d=document.querySelector(m))}else d=document.querySelector(t.selector);switch(a){case"show":if(u)for(let Ae of d)g&&h==Ae||(Ae.style.display=n.display?this.handleTemplateVars(n.display,{event:e.event}):"block");else{if(d==window||d==document)return;d.style||(d.style={}),d.style.display=n.display?this.handleTemplateVars(n.display,{event:e.event}):"block"}break;case"hide":if(u)for(let Ie of d)g&&h==Ie||(Ie.style.display="none");else d.style.display="none";break;case"addClass":if(!n.cssClass)break;if(u)for(let Le of d)g&&h==Le||Le.classList.add(this.handleTemplateVars(n.cssClass,{event:e.event}));else d.classList.add(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"removeClass":if(!n.cssClass)break;if(u)for(let Ve of d)g&&h==Ve||Ve.classList.remove(this.handleTemplateVars(n.cssClass,{event:e.event}));else d.classList.remove(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"toggleClass":if(!n.cssClass)break;if(u)for(let Ne of d)g&&h==Ne||Ne.classList.toggle(this.handleTemplateVars(n.cssClass,{event:e.event}));else d.classList.toggle(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"setAttribute":if(!n.attributeKey||!n.attributeValue)break;if(u)for(let Pe of d)g&&h==Pe||Pe.setAttribute(this.handleTemplateVars(n.attributeKey,{event:e.event}),this.handleTemplateVars(n.attributeValue,{event:e.event}));else d.setAttribute(this.handleTemplateVars(n.attributeKey,{event:e.event}),this.handleTemplateVars(n.attributeValue,{event:e.event}));break;case"removeAttribute":if(!n.attributeKeyRemoval)break;if(u)for(let Ce of d)g&&h==Ce||Ce.removeAttribute(this.handleTemplateVars(n.attributeKeyRemoval,{event:e.event}));else d.removeAttribute(this.handleTemplateVars(n.attributeKeyRemoval,{event:e.event}));break;case"innerText":if(!n.innerText)break;if(u)for(let Fe of d)g&&h==Fe||(Fe.innerText=this.handleTemplateVars(n.innerText,{event:e.event}));else d.innerText=this.handleTemplateVars(n.innerText,{event:e.event});break;case"gsap":if("pageLoad"==t.event&&await this.wait(0),!n.animationAction||!n.animationTimeline)return;let v=n.animationAction,b=n.animationTimeline,y=n.animationSelectorType?n.animationSelectorType:"all",w=null!=n.animationTimeScale?n.animationTimeScale:1,k=[];"all"==y&&(k=this.timelines.filter((e=>e.id==b))),"trigger"==y&&(k=this.timelines.filter((e=>{let t=[...s.getElementsByTagName("*")].includes(e.trigger),a=e.trigger.contains(s);return!(e.id!=b||e.trigger!=s&&!t&&!a)}))),k.forEach((e=>{let a=e.tl;if(1!=w&&a.timeScale(w),t.event.includes("wpgb")){let e=a.getChildren();return a.clear(),e.forEach((e=>{let t=e.vars,n=(e.delay(),e.data.method),i=e._start,s=e.data.selector;switch(n){case"to":t.autoAlpha=1,a.to(s,{...t},i);break;case"from":t.autoAlpha=0,a.from(s,{...t},i);break;case"fromTo":t.autoAlpha=1,a.fromTo(s,{...t.startAt},{...t},i)}})),void a.restart()}switch(v){case"play":a.play();break;case"pause":a.pause();break;case"restart":a.restart();break;case"resume":a.resume();break;case"reverse":a.reverse()}}));break;case"jsFunction":if(!n.jsFunctionName)return;let S=e.event,D=n.jsFunctionName,T=new Function("return (async (trigger, event, timelines, getTimeline) => {"+D+"})")();"function"==typeof T&&(async()=>{const e=await this.getTimelines();await T(i,S,e,(async e=>await this.getTimelineById(e)))})();break;case"ajaxFunction":if(!n.ajaxFunctionName)return;const E=BRFPANEL.ajaxurl,A=this.handleTemplateVars(n.ajaxFunctionName,{event:e.event}),I=this.handleTemplateVars(n.ajaxFunctionLiveUpdateSelector,{event:e.event}),L=n.ajaxFunctionLiveUpdateInsertMethod??"innerHTML",V=n.ajaxFunctionDebug;let N=n.ajaxFunctionData,P={};P.action=A,P.nonce=BRFPANEL.ajaxNonce,N&&N.length>0&&N.forEach((t=>{P[this.handleTemplateVars(t.key,{event:e.event})]=this.handleTemplateVars(t.value,{event:e.event})}));try{let Oe=await fetch(E,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(P).toString()}),Re=await Oe.json();if(Re&&Re.data){const xe=Re.data.message??!1;if(V&&console.log("Bricksforge Ajax Response",Re.data),xe&&I){const qe=document.querySelector(I);if(qe)switch(L){case"innerHTML":qe.innerHTML=xe;break;case"appendHTML":qe.insertAdjacentHTML("beforeend",xe);break;case"prependHTML":qe.insertAdjacentHTML("afterbegin",xe);break;case"innerText":qe.innerText=xe;break;case"append":qe.append(xe);break;case"prepend":qe.prepend(xe)}}}}catch(Be){console.log(Be)}break;case"sendEmail":if(!e.actionData.emailDesignerTemplate)return void console.warn("No email designer template selected");if(window.bricksforgeData.lastSentEmail&&window.bricksforgeData.lastSentEmail>Date.now()-1e3)return;const C=e.actionData.emailDesignerTemplate,F=BRFPANEL.ajaxurl,O="bricksforge_send_mail";let R={};R.action=O,R.nonce=BRFPANEL.ajaxNonce,R.template=C,e.actionData.mailTo&&(R.to=this.handleTemplateVars(e.actionData.mailTo,{event:e.event})),e.actionData.mailSubject&&(R.subject=this.handleTemplateVars(e.actionData.mailSubject,{event:e.event})),e.actionData.mailMessage&&(R.message=this.handleTemplateVars(e.actionData.mailMessage,{event:e.event}));try{200==(await fetch(F,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(R).toString()})).status&&(window.bricksforgeData.lastSentEmail=Date.now())}catch(_e){console.log(_e)}break;case"updateOption":if(!n.optionName||!n.optionValue)return;let x=this.handleTemplateVars(n.optionName,{event:e.event}),q=this.handleTemplateVars(n.optionValue,{event:e.event}),B=!!n.ajaxFunctionLiveUpdateSelector&&n.ajaxFunctionLiveUpdateSelector;const _=n.ajaxFunctionLiveUpdateInsertMethod?n.ajaxFunctionLiveUpdateInsertMethod:"replaceText",j=BRFPANEL.ajaxurl;let M={action:"bricksforge_update_option"};M.nonce=BRFPANEL.ajaxNonce,M.option_name=x,M.option_value=q;try{let je=await fetch(j,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(M).toString()});if(200==je.status&&B){if(B=document.querySelector(B),!B)return;let Me=await je.json();if(Me=Me.data.message??!1,!Me)return;switch(_){case"innerHTML":B.innerHTML=Me;break;case"appendHTML":B.insertAdjacentHTML("beforeend",Me);break;case"prependHTML":B.insertAdjacentHTML("afterbegin",Me);break;case"innerText":B.innerText=Me;break;case"append":B.append(Me);break;case"prepend":B.prepend(Me)}}}catch(He){console.log(He)}break;case"deleteOption":if(!n.optionName)return;let H=this.handleTemplateVars(n.optionName,{event:e.event});const W=BRFPANEL.ajaxurl;let z={action:"bricksforge_delete_option"};z.nonce=BRFPANEL.ajaxNonce,z.option_name=H;try{await fetch(W,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(z).toString()})}catch(We){console.error(We)}break;case"gsapFlip":if(!d)break;gsap.registerPlugin(Flip);let K=e.actionData.flipStylesProps?e.actionData.flipStylesProps:"",G=e.actionData.flipEase?e.actionData.flipEase:"power1.inOut",Y=e.actionData.flipDuration?e.actionData.flipDuration:1,U=!!e.actionData.flipIncludeChildren&&e.actionData.flipIncludeChildren,X=!!e.actionData.flipAbsolute&&e.actionData.flipAbsolute;if(u)for(let ze of d){if(g&&h==ze)continue;const Ke=Flip.getState(1==U?[ze,...ze.children]:ze,{props:K});if(ze.style.setProperty("transition","none"),U)for(let Ge of ze.children)Ge.style.setProperty("transition","none");switch(e.actionData.flipStylesInput){case"custom":if(!e.actionData.flipStylesCode)break;let Ye=new Function("return ((trigger, target, event) => {"+e.actionData.flipStylesCode+"})")();"function"==typeof Ye&&Ye(i,ze,e.event);break;case"removeClass":if(!e.actionData.flipStylesInputClassName)return;ze.classList.remove(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"addClass":if(!e.actionData.flipStylesInputClassName)return;ze.classList.add(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"toggleClass":if(!e.actionData.flipStylesInputClassName)return;ze.classList.toggle(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"appendTo":if(!e.actionData.flipStylesInputDOMElement)return;document.querySelector(this.handleTemplateVars(e.actionData.flipStylesInputDOMElement,{event:e.event})).append(ze)}Flip.from(Ke,{duration:Y,ease:G,absolute:X,nested:!0})}else{const Ue=Flip.getState(1==U?[d,...d.children]:d,{props:K});if(d.style.setProperty("transition","none"),U)for(let Xe of d.children)Xe.style.setProperty("transition","none");switch(e.actionData.flipStylesInput){case"custom":if(!e.actionData.flipStylesCode)break;let Qe=new Function("return ((trigger, target, event) => {"+e.actionData.flipStylesCode+"})")();"function"==typeof Qe&&Qe(i,d,e.event);break;case"removeClass":if(!e.actionData.flipStylesInputClassName)return;d.classList.remove(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"addClass":if(!e.actionData.flipStylesInputClassName)return;d.classList.add(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"toggleClass":if(!e.actionData.flipStylesInputClassName)return;d.classList.toggle(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"appendTo":if(!e.actionData.flipStylesInputDOMElement)return;document.querySelector(this.handleTemplateVars(e.actionData.flipStylesInputDOMElement,{event:e.event})).append(d)}Flip.from(Ue,{duration:Y,ease:G,absolute:X})}break;case"gsapSet":if(!d)break;if(!n.gsapSetObject&&n.gsapObject&&(n.gsapSetObject=n.gsapObject),u)for(let $e of d){let Je=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),Ze=new Function("return (trigger, target, event) => { return "+Je+" }")();gsap.set(d,"function"==typeof Ze?Ze(i,$e,e.event):{})}else{let et=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),tt=new Function("return (trigger, target, event) => { return "+et+" }")();gsap.set(d,"function"==typeof tt?tt(i,d,e.event):{})}break;case"gsapFrom":if(!d)break;if(!n.gsapSetObject&&n.gsapObject&&(n.gsapSetObject=n.gsapObject),u)for(let at of d){let nt=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),it=new Function("return (trigger, target, event) => { return "+nt+" }")();gsap.from(d,"function"==typeof it?it(i,at,e.event):{})}else{let st=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),rt=new Function("return (trigger, target, event) => { return "+st+" }")();gsap.from(d,"function"==typeof rt?rt(i,d,e.event):{})}break;case"gsapTo":if(!d)break;if(!n.gsapSetObject&&n.gsapObject&&(n.gsapSetObject=n.gsapObject),u)for(let ot of d){let lt=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),ct=new Function("return (trigger, target, event) => { return "+lt+" }")();gsap.to(d,"function"==typeof ct?ct(i,ot,e.event):{})}else{let dt=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),ut=new Function("return (trigger, target, event) => { return "+dt+" }")();gsap.to(d,"function"==typeof ut?ut(i,d,e.event):{})}break;case"followCursor":if(!d)break;u&&(console.warn("Bricksforge Panel: The action 'Follow Cursor' does not support multiple targets. The first target will be used."),d=d[0]);let Q,$=d.offsetLeft,J=d.offsetTop,Z=n.offsetX?n.offsetX:0,ee=n.offsetY?n.offsetY:0,te=void 0!==n.smoothValue?n.smoothValue:20,ae=n.lockPosition?n.lockPosition:"fixed",ne="block",ie=!!n.autoSetOpacity,se=!!n.bindToElement,re=!!n.forceHideWhenLeaves;if(ie&&(d.style.opacity=1,d.style.visibility="visible"),re&&(d.style.visibility="visible"),se){if(ae="absolute",Q=e.selector,Q&&(Q.style.overflow="hidden",Q.style.position="relative",!Q.contains(d))){let gt=Q.getBoundingClientRect(),pt=d.getBoundingClientRect();$=pt.left-gt.left,J=pt.top-gt.top,d.style.position=ae,d.style.left=$+"px",d.style.top=J+"px",d.style.display=ne,Q.append(d)}}else d.style.position=ae,d.style.display=ne;let oe=d.getBoundingClientRect();Z=oe.width/2,ee=oe.height/2;let le=$,ce=J,de=e.event.clientX,ue=e.event.clientY,ge=!1;function pe(){let e=de-le-Z,t=ue-ce-ee;if(se){let a=Q.getBoundingClientRect();e-=a.left,t-=a.top}e/=te,t/=te,le+=e,ce+=t,d.style.left=le+"px",d.style.top=ce+"px",Math.abs(e)>.1||Math.abs(t)>.1?requestAnimationFrame(pe):ge=!1}function he(e){de=e.clientX,ue=e.clientY,ge||(ge=!0,requestAnimationFrame(pe))}he(e.event);break;case"video_self_hosted_play":if(!d)break;if(u)for(let ht of d)g&&h==ht||("VIDEO"!=ht.tagName&&(ht=ht.querySelector("video")),ht&&ht.play());else{if("VIDEO"!=d.tagName&&(d=d.querySelector("video")),!d)break;d.play()}break;case"video_self_hosted_pause":if(!d)break;if(u)for(let ft of d)g&&h==ft||("VIDEO"!=ft.tagName&&(ft=ft.querySelector("video")),ft&&ft.pause());else{if("VIDEO"!=d.tagName&&(d=d.querySelector("video")),!d)break;d.pause()}break;case"video_self_hosted_stop":if(!d)break;if(u)for(let mt of d)g&&h==mt||("VIDEO"!=mt.tagName&&(mt=mt.querySelector("video")),mt&&(mt.pause(),mt.currentTime=0));else{if("VIDEO"!=d.tagName&&(d=d.querySelector("video")),!d)break;d.pause(),d.currentTime=0}break;case"storageSetItem":if(!e.actionData.storageItemKey||!e.actionData.storageItemValue)break;localStorage.setItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}),this.handleTemplateVars(e.actionData.storageItemValue,{event:e.event}));break;case"storageRemoveItem":if(!e.actionData.storageItemKey)break;localStorage.removeItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}));break;case"sessionStorageSetItem":if(!e.actionData.storageItemKey||!e.actionData.storageItemValue)break;sessionStorage.setItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}),this.handleTemplateVars(e.actionData.storageItemValue,{event:e.event}));break;case"sessionStorageRemoveItem":if(!e.actionData.storageItemKey)break;sessionStorage.removeItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}));break;case"syncSliders":let fe=e.actionData.syncSliderData;if(!fe||!fe.length){console.warn('Bricksforge Panel: You try to use "syncSliders" action, but we found no data for it.');break}for(let vt of fe){let bt=vt.slider1,yt=vt.slider2;bt&&yt&&(bt=bricksData.splideInstances[bt],yt=bricksData.splideInstances[yt],bt&&yt&&bt.sync(yt))}break;case"previousSlide":{if(!e.actionData.sliderId)break;let wt=this.handleTemplateVars(e.actionData.sliderId,{event:e.event});if(!wt)break;let kt=bricksData.splideInstances[wt];if(!kt)break;kt.go("<");break}case"nextSlide":{if(!e.actionData.sliderId)break;let St=this.handleTemplateVars(e.actionData.sliderId,{event:e.event});if(!St)break;let Dt=bricksData.splideInstances[St];if(!Dt)break;Dt.go(">");break}case"openPopup":if(!e.actionData.popupId)break;let me=this.handleTemplateVars(e.actionData.popupId,{event:e.event});if("function"!=typeof bricksOpenPopup)break;let ve=document.querySelector(".brxe-popup-"+me);if(!ve){console.warn("Bricksforge Panel: Popup "+me+" not found.");break}bricksOpenPopup(ve);break;case"closePopup":if(!e.actionData.popupId)break;let be=this.handleTemplateVars(e.actionData.popupId,{event:e.event});if("function"!=typeof bricksClosePopup)break;let ye=document.querySelector(".brxe-popup-"+be);if(!ye){console.warn("Bricksforge Panel: Popup "+be+" not found.");break}bricksClosePopup(ye);break;case"populateFormField":let we=e.actionData.formFieldValue;if(!we)break;if(we=this.handleTemplateVars(we,{event:e.event}),u){for(let Tt of d)if(!g||h!=Tt){if(d=this.findFormField(d),!d)break;Tt.value=we}}else{if(d=this.findFormField(d),!d)break;d.value=we}break;case"makeConfetti":if("undefined"==typeof confetti)return;const ke=e.actionData.confettiType?e.actionData.confettiType:"basic",Se=e.actionData.confettiDuration?1e3*parseInt(e.actionData.confettiDuration):5e3,De=e.actionData.delay?e.actionData.delay:0;setTimeout((()=>{this.fireConfetti(ke,Se)}),1e3*De);break;case"updateGlobalVariable":let Te=e.actionData?.variableName,Ee=e.actionData?.variableValue;if(!Te||!Ee)break;Te=this.handleTemplateVars(Te,{event:e.event}),Ee=this.handleTemplateVars(Ee,{event:e.event}),window.bricksforgeData?.globalVariables||(window.bricksforgeData.globalVariables={}),window.bricksforgeData.globalVariables[Te]=Ee}}fireConfetti(e,t){let a={x:.5,y:.6};function n(e,t){return Math.random()*(t-e)+e}switch(e){case"basic":confetti({particleCount:100,spread:70,origin:a});break;case"random":confetti({angle:n(55,125),spread:n(50,70),particleCount:n(50,100),origin:{y:.6}});break;case"realistic":var i={origin:a};function l(e,t){confetti({...i,...t,particleCount:Math.floor(200*e)})}l(.25,{spread:26,startVelocity:55}),l(.2,{spread:60}),l(.35,{spread:100,decay:.91,scalar:.8}),l(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),l(.1,{spread:120,startVelocity:45});break;case"fireworks":var s=Date.now()+t,r=(i={startVelocity:30,spread:360,ticks:60,zIndex:0},setInterval((function(){var e=s-Date.now();if(e<=0)return clearInterval(r);var a=e/t*50;confetti({...i,particleCount:a,origin:{x:n(.1,.3),y:Math.random()-.2}}),confetti({...i,particleCount:a,origin:{x:n(.7,.9),y:Math.random()-.2}})}),250));break;case"stars":i={spread:360,ticks:50,gravity:0,decay:.94,startVelocity:30,colors:["FFE400","FFBD00","E89400","FFCA6C","FDFFB8"]};function c(){confetti({...i,particleCount:40,scalar:1.2,shapes:["star"]}),confetti({...i,particleCount:10,scalar:.75,shapes:["circle"]})}setTimeout(c,0),setTimeout(c,100),setTimeout(c,200);break;case"snow":s=Date.now()+t;var o=1;!function e(){var a=s-Date.now(),i=Math.max(200,a/t*500);o=Math.max(.8,o-.001),confetti({particleCount:1,startVelocity:0,ticks:i,origin:{x:Math.random(),y:Math.random()*o-.2},colors:["#ffffff"],shapes:["circle"],gravity:n(.4,.6),scalar:n(.4,1),drift:n(-.4,.4)}),a>0&&requestAnimationFrame(e)}()}}findFormField(e){const t=["input","select","textarea"];for(let a of t){let t=e.querySelector(a)||e.closest(a);if(t)return t}return null}isPanelOpen(){const e="true"==document.body.getAttribute("data-brf-panel-open");if(window.parent&&window.parent.document){const t="true"==window.parent.document.body.getAttribute("data-brf-panel-open");return e||t}return e}selectorExists(e){try{return!!document.querySelector(e)}catch(e){return!1}}getLabelFromObject(e){return e&&"object"==typeof e&&e.label?e.label:e}handleTimeline(e,t=!1,a=!1){gsap.config({nullTargetWarn:!1}),e.animations&&e.animations.length||!bricksIsFrontend||console.warn("Bricksforge Panel: You try to use timelines, but we found no animations for it. This warning appears for the timeline: "+e.name);let n=e.repeat?parseInt(e.repeat):0,i=e.repeatDelay?parseInt(e.repeatDelay):0,s=e.trigger?e.trigger:"scrollTrigger",r=e.triggerSelector?e.triggerSelector:"",o=!!e.animateTrigger&&e.animateTrigger,l=null!=e.scrub&&e.scrub,c=null!=e.scrubValue?e.scrubValue:1,d=e.scrollStart?e.scrollStart:"top bottom",u=e.scrollEnd?e.scrollEnd:"bottom top";isNaN(parseFloat(d))||(d=parseFloat(d)),isNaN(parseFloat(u))||(u=parseFloat(u));let g=null!=e.pin&&e.pin,p=!e.pinSelector||e.pinSelector,h=null!=e.pinSpacing&&e.pinSpacing,f=null!=e.markers&&e.markers,m=null!=e.stagger&&e.stagger,v=e.staggerAmount?e.staggerAmount:.2,b=e.staggerFrom?e.staggerFrom:"start",y=e.staggerEase?e.staggerEase:"linear",w=e.toggleActions?e.toggleActions:"play none none none",k=null!=e.snap&&e.snap,S=!!e.snapTo&&e.snapTo,D=null!=e.automaticSnap&&e.automaticSnap,T=e.automaticSnapSelector?e.automaticSnapSelector:"",E=e.snapDuration?e.snapDuration:.3,A=e.snapDelay?e.snapDelay:.1,I=e.snapEase?e.snapEase:"power1.inOut",L=!!e.toggleClass&&e.toggleClass,V=e.toggleClassTargets?e.toggleClassTargets:"",N=e.toggleClassClassName?e.toggleClassClassName:"",P=null!=e.batch&&e.batch,C=null!=e.withSecondaryClick&&e.withSecondaryClick,F=null!=e.reverseWhenClickingOutside&&e.reverseWhenClickingOutside,O=null!=e.reverseTimescale?e.reverseTimescale:1,R=null!=e.withSecondaryMouseLeave&&e.withSecondaryMouseLeave,x=null!=e.excludeAnimationLayers&&e.excludeAnimationLayers,q=null!=e.yoyo&&e.yoyo,B=null!=e.excludedSelectors?e.excludedSelectors:"",_=e.reverseAnimationSelector?e.reverseAnimationSelector:"",j=null!=e.asArray&&1==e.asArray;if(B=B&&"string"==typeof B?B.split(","):[],"string"!=typeof w&&w.label&&(w=w.label),d=this.getLabelFromObject(d),u=this.getLabelFromObject(u),w=this.getLabelFromObject(w),"scrollTrigger"===s)bricksIsFrontend&&(gsap.registerPlugin(ScrollTrigger),ScrollTrigger.config({ignoreMobileResize:!0}));if(gsap.plugins.drawSVG&&gsap.registerPlugin(DrawSVGPlugin),gsap.plugins.MorphSVGPlugin&&gsap.registerPlugin(MorphSVGPlugin),!r||"."==r||!this.isValidSelector(r))if("custom"!=s){if(bricksIsFrontend)return}else r="html";this.selectorExists(r)||(r=".brf-dummy"),gsap.utils.toArray(r).forEach((async(M,H)=>{let W=j;if(P&&(o=!1,H>=1))return;const z=gsap.timeline({repeat:n,repeatDelay:i,yoyo:q,..."scrollTrigger"==s&&e.animations.length&&bricksIsFrontend&&!P&&{scrollTrigger:{...1==L&&{toggleClass:{targets:V,className:N}},trigger:M,markers:f,start:d,...1==k&&{snap:{snapTo:(()=>{if(null==D||!D||!T)return S;return 1/(gsap.utils.toArray(T).length-1)})(),duration:E,delay:A,ease:I}},toggleActions:w,end:u,...1==l&&{scrub:c},...1==g&&p&&{pin:p||!0,pinSpacing:h},onRefresh:e=>this.handleRefresh(e)}}});if(!0===a&&z.pause(0),"custom"!=s&&"click"!=s&&"hover"!=s||z.pause(),"click"==s&&(M.addEventListener("click",(t=>{if(e.disabled)return;for(let e of B)if(t.target.closest(e)||t.target==document.querySelector(e))return;if(t.preventDefault(),z.timeScale(1),z.reversed()||!0!==C||0==z.progress()?0!=z.progress()&&1!=z.progress()?z.play():z.restart():(1!=O&&z.timeScale(O),z.reverse()),_){const e=document.querySelector(_);e&&e.addEventListener("click",(e=>{e.preventDefault(),z.timeScale(1),1!=O&&z.timeScale(O),z.reverse()}))}let a=t.target.tagName.toLowerCase(),n=t.target.closest("a");n&&(a=n.tagName.toLowerCase()),"a"==a&&z.eventCallback("onComplete",(()=>{t.target.href&&(window.location.href=t.target.href)}))})),F)){const t=[];if(t.push(M),!0===x)for(let a of e.animations)if(a.selector&&document.querySelectorAll(a.selector).forEach((e=>{t.push(e)})),a.childSelector){this.getCachedElement(a.selector).querySelectorAll(a.childSelector).forEach((e=>{t.push(e)}))}document.addEventListener("click",(e=>{for(let a of t)if(a.contains(e.target)||a==e.target)return;z.reversed()||z.paused()||(1!=O&&z.timeScale(O),z.reverse())}))}"hover"==s&&(M.addEventListener("mouseenter",(t=>{if(!e.disabled){for(let e of B)if(t.target.closest(e)||t.target==this.getCachedElement(e))return;z.timeScale(1),0!=z.progress()&&1!=z.progress()?z.play():z.restart()}})),!0===R&&M.addEventListener("mouseleave",(()=>{1!=O&&z.timeScale(O),z.reverse()})));for(let n of e.animations){if(!(!0!==a||n.selector&&this.isValidSelector(n.selector)&&document.querySelector(n.selector))){if(bricksIsFrontend)continue}if(!n.selector&&!1===o){bricksIsFrontend&&console.warn("Bricksforge Panel: You try to use timeline animations, but we found no selector for it. This warning appears for the timeline: "+e.name);continue}if(("."==n.selector&&!1===o||!this.isValidSelector(n.selector)||!1===o&&!document.querySelector(n.selector))&&bricksIsFrontend)continue;if(!(n.data&&""!=n.data||n.controls&&0!==Object.keys(n.controls).length)&&bricksIsFrontend){console.warn("Bricksforge Panel: You try to use timeline animations, but we found no animation data for it. This warning appears for the timeline: "+e.name);continue}const i=bricksIsFrontend?document:window.parent.document.querySelector("#bricks-builder-iframe").contentDocument,s=bricksIsFrontend?0:150;"."!=n.selector&&setTimeout((()=>{if(i.querySelector(n.selector)){if(i.querySelectorAll(n.selector).length>50)return;i.querySelectorAll(n.selector).forEach((e=>{if(e.classList.add("brf-reset-transition"),n.childSelector){let e=i.querySelector(n.selector);if(e.querySelectorAll(n.childSelector).length>50)return;e.querySelectorAll(n.childSelector).forEach((e=>{e.classList.add("brf-reset-transition")}))}}))}}),s);let D=n.controls?n.controls:{};Object.keys(D).forEach((e=>{null===D[e]&&delete D[e]}));let T,C=n.controls2?n.controls2:{};Object.keys(C).forEach((e=>{null===C[e]&&delete C[e]}));try{T=new Function("return (triggerSelector, target, trigger, timeline) => {return "+n.data.replace(/cssVar\((.*?)\)/g,((e,t)=>this.cssVar(t.trim())))+"}")(this)}catch(e){if(T=new Function,bricksIsFrontend)continue}try{T(r,n.selector,M,z)}catch(t){if(T=new Function,console.warn("Bricksforge Panel: You try to use timeline animations, but your Animation data object seems to be wrong. This warning appears for the timeline: "+e.name),bricksIsFrontend)continue}let F,O,R=T(r,n.selector,M,z),x=n.duration?n.duration:.5,q=n.delay?n.delay:0,B=n.position?n.position:">",_=null!=typeof n.customPosition?n.customPosition:">",j=n.ease?n.ease:"linear",K=!!n.splitText&&n.splitText,G=n.splitTextType?n.splitTextType:"chars",Y=!!n.stagger&&n.stagger,U=n.staggerValue?n.staggerValue:.02,X=null!=n.yoyo&&n.yoyo,Q=n.repeat?n.repeat:0;switch(B){case"<":case">":F=B;break;case"custom":F=this.isNumeric(_)?parseFloat(_):_;break;default:F=">"}if(!0===t&&gsap.set(n.selector,{clearProps:"all"}),!0===o&&r)if(n.childSelector){const e=M.querySelectorAll(n.childSelector);!1===t&&gsap.set(e,{clearProps:"all"}),O=e,bricksIsFrontend||(O=this.getCachedElement(r+" "+n.childSelector,!0))}else O=M,bricksIsFrontend||(O=this.getCachedElement(r,!0));else O=n.selector;if(O||(O=".brf-dummy"),"."==O&&(O=".brf-dummy"),bricksIsFrontend||z.pause(0),!0===K){let e;gsap.registerPlugin(SplitText);let t=this.splitTextInstances.find((e=>e.id==n.id)),a=n.splitTextType;switch("chars"==a&&(a="words, chars"),bricksIsFrontend?(e=new SplitText(O,{type:a,charsClass:"brf-split brf-split-chars",linesClass:"brf-split brf-split-lines",wordsClass:"brf-split brf-split-words",tag:"chars"==n.splitTextType?"span":"div"}),this.splitTextInstances.push({id:n.id,type:a,animation:n.id,data:e})):(t?e=t:(e=this.splitTextInstances.push({id:n.id,type:a,animation:n.id,data:new SplitText(O,{type:n.splitTextType,charsClass:"brf-split brf-split-chars",linesClass:"brf-split brf-split-lines",wordsClass:"brf-split brf-split-words",tag:"chars"==n.splitTextType?"span":"div"})}),e=this.splitTextInstances.find((e=>e.id==n.id))),e=e.data),G){case"chars":O=e.chars;break;case"words":O=e.words;break;case"lines":O=e.lines}}if(void 0!==this.timelineActions.find((e=>e.finalSelector==O&&e.id==n.id&&!W))&&bricksIsFrontend)continue;if(bricksIsFrontend){let e=!1,t=[];"string"==typeof O&&(t=document.querySelectorAll(O)),"object"==typeof O&&t.push(O[0]),t.forEach((t=>{t&&t.classList&&(t.classList.contains("brf-prevent-fouc")||t.closest(".brf-prevent-fouc"))&&(e=!0,t.closest(".brf-prevent-fouc")&&(t=t.closest(".brf-prevent-fouc")),t.classList.contains("brf-reset-transition")?("from"==n.method&&(D.autoAlpha=0),"to"==n.method&&(D.autoAlpha=1),"fromTo"==n.method&&(D.autoAlpha=0,C.autoAlpha=1),this.removeFoucClass(t)):this.removeFoucClass(t))}))}if("string"==typeof O&&"."!=O&&void 0!==document.querySelector(O)){const e=document.querySelector(O);if(e&&e.classList.contains("brf-three-js")&&n.animate3DModel){const e=async()=>new Promise(((e,t)=>{let a=setInterval((()=>{bricksforgeData&&bricksforgeData.models&&(clearInterval(a),e(bricksforgeData.models))}),50);setTimeout((()=>{clearInterval(a),t(new Error("Timeout: Model data not available"))}),2e3)}));let t=await e(),a=bricksforgeData.cameras;if(t){O=document.querySelector(O);let e=!!t[O.dataset.scriptId]&&t[O.dataset.scriptId],i=a[O.dataset.scriptId],s=n.animate3DModelObject?n.animate3DModelObject:"model",r="position";if("model"==s&&(r=n.animate3DModelProperty?n.animate3DModelProperty:"position"),"camera"==s&&(r=n.animate3DCameraProperty?n.animate3DCameraProperty:"position"),e)switch(r){case"rotation":"model"==s?O=e.rotation:"camera"==s&&(O=i.rotation);break;case"position":"model"==s?O=e.position:"camera"==s&&(O=i.position);break;case"scale":"model"==s?O=e.scale:"camera"==s&&(O=i.scale)}}}}let $=gsap.utils.toArray(O);if(n.perspective&&n.perspectiveValue?$.forEach((e=>{e&&e.parentNode&&gsap.set(e.parentNode,{perspective:n.perspectiveValue})})):bricksIsFrontend||$.forEach((e=>{e&&e.parentNode&&gsap.set(e.parentNode,{perspective:"none"})})),W)if(Array.isArray(O)){if(O[0].classList.contains("brf-split")){let e=this.getCachedElement(n.selector,!0)[H],t=new SplitText(e,{type:n.splitTextType,charsClass:"brf-split brf-split-chars",linesClass:"brf-split brf-split-lines",wordsClass:"brf-split brf-split-words",tag:"chars"==n.splitTextType?"span":"div"}).chars;t&&t.length&&(O=t)}}else{let e=gsap.utils.toArray(O);e&&e.length&&void 0!==e[H]&&(O=e[H])}if(!bricksIsFrontend&&!this.isPanelOpen())return;const J=D&&(D.hasOwnProperty("morphSVG")||R&&"string"==typeof R.morphSVG);switch(bricksIsFrontend||n.animate3DModel||(O=this.getElementsUpTo(this.maxQueryNodes,O)),n.method){case"from":P&&bricksIsFrontend?ScrollTrigger.batch(O,{once:1==l||w&&"none"==w.split(" ")[2],markers:f,start:d,end:u,...1==L&&{toggleClass:{targets:V,className:N}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{z.from(e,{data:{id:n.id,method:"from",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,delay:q,yoyo:X,repeat:Q,...R,...D,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}},scrollTrigger:{trigger:e,toggleActions:w,...1==k&&{snap:{snapTo:S,duration:E,delay:A,ease:I}},...1==g&&p&&{pin:p||!0,pinSpacing:h},...1==l&&{scrub:c}}})},animationPositionValue:F}):z.from(O,{data:{id:n.id,method:"from",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,delay:q,yoyo:X,repeat:Q,...R,...D,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}}},F);break;case"to":P&&bricksIsFrontend?ScrollTrigger.batch(O,{once:1==l||w&&"none"==w.split(" ")[2],markers:f,start:d,end:u,...1==L&&{toggleClass:{targets:V,className:N}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{z.to(e,{data:{id:n.id,method:"to",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,yoyo:X,repeat:Q,delay:q,...R,...D,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:E,delay:A,ease:I}},...1==l&&{scrub:c},...1==g&&p&&{pin:p||!0,pinSpacing:h}}})},animationPositionValue:F}):z.to(O,{data:{id:n.id,method:"to",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,delay:q,yoyo:X,repeat:Q,...R,...D,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}}},F);break;case"fromTo":let t;try{t=new Function("return (triggerSelector, target, trigger, timeline) => {return "+n.data2.replace(/cssVar\((.*?)\)/g,((e,t)=>this.cssVar(t.trim())))+"}")(this)}catch(e){if(t=new Function,bricksIsFrontend)continue}try{t(r,n.selector,M,z)}catch(a){if(t=new Function,console.warn("Bricksforge Panel: You try to use timeline animations, but your Animation data object seems to be wrong. This warning appears for the timeline: "+e.name),bricksIsFrontend)continue}let a=t(r,n.selector,M,z);P&&bricksIsFrontend?ScrollTrigger.batch(O,{once:1==l||w&&"none"==w.split(" ")[2],markers:f,start:d,end:u,...1==L&&{toggleClass:{targets:V,className:N}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{z.fromTo(e,{data:{id:n.id,method:"fromTo",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,delay:q,yoyo:X,repeat:Q,...R,...D,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:E,delay:A,ease:I}},...1==l&&{scrub:c},...1==g&&p&&{pin:p||!0,pinSpacing:h}}},{data:{id:n.id,method:"fromTo",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},duration:x,delay:q,yoyo:X,repeat:Q,...a,...C,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:E,delay:A,ease:I}},...1==l&&{scrub:c},...1==g&&p&&{pin:p||!0,pinSpacing:h}}},F)}}):z.fromTo(O,{data:{id:n.id,method:"fromTo",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},...R,...D,yoyo:X,repeat:Q,immediateRender:bricksIsFrontend,duration:x,delay:q,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}}},{data:{id:n.id,method:"fromTo",selector:n.selector,gsapSelector:O,triggerSelector:r,isMorph:J},...a,...C,duration:x,yoyo:X,repeat:Q,delay:q,ease:j,...!0===Y&&{stagger:U},...!Y&&m&&{stagger:{from:b,amount:v,ease:y}}},F)}this.timelineActions.push({finalSelector:O,animationData:R,animationControls:D,id:n.id})}if(!1===t&&(z.getChildren().length>0&&this.timelines.push({id:e.id,tl:z,children:z.getChildren(),trigger:M}),bricksforgeData&&bricksforgeData.panel)){let t=bricksforgeData.panel.timelines.find((t=>t.id===e.id));t?t={id:e.id,tl:z,children:z.getChildren(),trigger:M}:bricksforgeData.panel.timelines.push({id:e.id,tl:z,children:z.getChildren(),trigger:M})}}))}handleRefresh(e){window.scrollY>window.innerHeight&&e.progress&&e.animation.progress(1)}async getTimelineById(e){return new Promise(((t,a)=>{setTimeout((()=>{let n=this.timelines.find((t=>t.id==e));n?t(n):a(new Error("Timeline not found"))}))}))}cssVar(e){let t,a="";e.includes(",")?(a=e.split(",")[0],t=e.split(",")[1]):a=e,a=a.replace(/['"]+/g,""),t&&(t=t.replace(/['"]+/g,""));let n="'"+getComputedStyle(t?document.querySelector(t):document.body).getPropertyValue(a.toString().trim())+"'";return n=n.replace(/' /g,"'"),n=n.trim(),n}async handleSliderEvent(e){if(!e)return console.warn("No Slider ID set"),!1;let t=bricksData.splideInstances;if("undefined"!=typeof xSlider&&(await this.waitForXSliderInstances(),t={...t,...xSlider.Instances}),!t)return console.warn("No Slider Instances found"),!1;const a=t[e];return a||(console.warn("No Slider found with the ID "+e),!1)}async waitForXSliderInstances(){return new Promise(((e,t)=>{let a=0;const n=setInterval((()=>{a+=100,Object.keys(xSlider.Instances).length>0&&(clearInterval(n),e()),a>=1e3&&(clearInterval(n),t())}),100)}))}async getTimelines(){return await new Promise((e=>{setTimeout((()=>{e()}))})),this.timelines}isValidSelector(e){try{return document.querySelector(e),!0}catch(e){}return!1}async wait(e=1e3){return new Promise((async t=>{setTimeout((()=>{t()}),e)}))}parseObject(e){return new Function("return "+e)}isNumeric(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}isParsable(e){try{JSON5.parse(e)}catch(e){return!1}return!0}isTriggeredSelector(e,t){return"string"==typeof e&&(e=document.querySelector(e)),"string"==typeof t&&(t=document.querySelector(t)),e==t}async handlePanelNodes(e){const t=e.nodes,a=e.connections,n=await this.prepareNodes(t,a);n.filter((e=>"event"==e.category)).forEach((e=>{this.shouldSkip(e.settings)||this.startNode(e,n,a)}))}async prepareNodes(e,t){return await Promise.all(e.map((async a=>{const n=a.settings?a.settings:{},i=this.findNodeEvent(a,e,t);i&&"event"!=a.category&&(a.event=i);const s=await this.getEventTriggerElement(a.event);let r,o=!1;s&&(r=s.target,o=s.queryAll);let l=n.target,c=n.targetElement,d=!1;const u=await this.getEventTargetElement(l,c,n,null,a);switch(u&&(c=u.target,d=u.queryAll),"document"==n.targetElement&&(c=document),"window"==n.targetElement&&(c=window),a.key){case"followCursor":{if(!!!n.forceHideWhenLeaves)break;const e=()=>{c&&NodeList.prototype.isPrototypeOf(c)?c.forEach((e=>{e&&(e.style.visibility="hidden")})):c&&(c.style.visibility="hidden")};o&&"object"==typeof r?r.forEach((t=>{t.addEventListener("mouseleave",e)})):r.addEventListener("mouseleave",e);break}}return a})))}findNodeEvent(e,t,a){let n=new Set;const i=e=>{if(n.add(e.id),"event"==e.category)return e;let s=a.find((t=>t.toNode==e.id));if(!s)return e;let r=t.find((e=>e.id==s.fromNode));return r?"event"===r.category?r:n.has(r.id)?null:i(r):null};return i(e)}async startNode(e,t,a){let n=a.find((t=>t.fromNode==e.id));if(!n)return;let i=t.find((e=>e.id==n.toNode)),s=e.key;this.currentRunningEvent=s;let r=e.settings?e.settings:{},o=(r.target,r.targetElement),l=!1;const c=await this.getEventTriggerElement(e);switch(c&&(o=c.target,l=c.queryAll),"document"==r.targetElement&&(o=document),"window"==r.targetElement&&(o=window),s){case"pageLoad":await this.runNode(i,t,a,"document",this.domContentLoadedEvent);break;case"scrollPosition":{const e=e=>{const n=window.scrollY,s=r.scrollPositionOperator||"==",o=parseInt(r.scrollPosition)||0;let l=!1;switch(s){case"==":l=n===o;break;case"!=":l=n!==o;break;case">":l=n>o;break;case">=":l=n>=o;break;case"<":l=n<o;break;case"<=":l=n<=o}l&&this.runNode(i,t,a,document,e)};window.addEventListener("scroll",e),e();break}case"scrollUp":{let e=0;const n=n=>{const s=window.scrollY;s<e&&this.runNode(i,t,a,document,n),e=s<=0?0:s};window.addEventListener("scroll",n),n();break}case"scrollDown":{let e=0;const n=n=>{const s=window.scrollY;s>e&&this.runNode(i,t,a,document,n),e=s};window.addEventListener("scroll",n),n();break}case"visibilitychange":{const e=e=>{document.visibilityState===r.visibilityState&&this.runNode(i,t,a,document,e)};document.addEventListener("visibilitychange",e),e();break}case"resize":{const e=e=>{const{resizeDimension:n,resizeOperator:s,resizeValue:o}=r;if(!n||!s||!o)return void this.runNode(i,t,a,document,e);const l="width"===n?window.innerWidth:window.innerHeight;let c=!1;switch(s){case"==":c=l==o;break;case">":c=l>o;break;case"<":c=l<o;break;case">=":c=l>=o;break;case"<=":c=l<=o}c&&this.runNode(i,t,a,document,e)};window.addEventListener("resize",e);break}case"mousemove":if(l){if(!o)return;o.forEach((e=>{e.addEventListener("mousemove",(async n=>{await this.runNode(i,t,a,e,n)}))}))}else o.addEventListener("mousemove",(async e=>{await this.runNode(i,t,a,o,e)}));case"resizeObserver":if(!o)return;new ResizeObserver((async e=>{for(let n of e)await this.runNode(i,t,a,n.target,n)})).observe(o);break;case"mutationObserver":{if(!o)return;const e={attributes:r.mutationObserverAttributes||!1,childList:r.mutationObserverChildList||!1,characterData:r.mutationObserverCharacterData||!1,subtree:r.mutationObserverSubtree||!1},n=new MutationObserver((async e=>{for(let n of e)await this.runNode(i,t,a,n.target,n)}));l?o.forEach((t=>{n.observe(t,e)})):n.observe(o,e);break}case"inViewport":case"notInViewport":{const e=new IntersectionObserver((async e=>{e.forEach((async e=>{("inViewport"===s&&e.isIntersecting||"notInViewport"===s&&!e.isIntersecting)&&await this.runNode(i,t,a,e.target,e)}))}),r.observerOptions);if(!o)return;l?o.forEach((t=>e.observe(t))):e.observe(o);break}case"sliderMove":case"sliderMoved":case"sliderVisible":case"sliderHidden":case"sliderClick":case"sliderResize":case"sliderResized":case"sliderDrag":case"sliderDragging":case"sliderDragged":case"sliderOverflow":{if(!r.sliderId)break;r.sliderId.startsWith("#brxe-")&&(r.sliderId=r.sliderId.replace("#brxe-",""));const e=await this.handleSliderEvent(r.sliderId);e&&e.on(s.replace("slider","").toLowerCase(),(async n=>{await this.runNode(i,t,a,e.root,n)}));break}case"wpgbFacetInit":case"wpgbFacetLoaded":case"wpgbFacetAppended":case"wpgbFacetRefresh":case"wpgbFacetChange":case"wpgbFacetReset":"undefined"!=typeof WP_Grid_Builder&&WP_Grid_Builder.instances&&Object.values(WP_Grid_Builder.instances).forEach((e=>{e.facets&&e.facets.on(s.replace("wpgbFacet","").toLowerCase(),(async n=>{await this.runNode(i,t,a,e.facets,n)}))}));break;case"submit":if(r.submitState||(r.submitState="success"),!o)break;l?o.forEach((e=>{e.addEventListener("brf_submit",(async n=>{const s=n.detail.success;(s||"success"!==r.submitState)&&(s&&"error"===r.submitState||await this.runNode(i,t,a,e,n))}))})):o.addEventListener("brf_submit",(async e=>{const n=e.detail.success;(n||"success"!==r.submitState)&&(n&&"error"===r.submitState||await this.runNode(i,t,a,o,e))}));break;case"custom":if(!r.customEventName)break;if(!o)break;l?o.forEach((e=>{e.addEventListener(r.customEventName,(async n=>{await this.runNode(i,t,a,e,n)}))})):o.addEventListener(r.customEventName,(async e=>{await this.runNode(i,t,a,o,e)}));break;default:if(!o)break;l?o.forEach((e=>{e.addEventListener(s,(async n=>{await this.runNode(i,t,a,e,n)}))})):o.addEventListener(s,(async e=>{await this.runNode(i,t,a,o,e)}))}}async getEventTriggerElement(e){if(!e)return;let t=!1,a=e.settings?e.settings:{},n=a.target,i=a.targetElement;switch(n){case"exactly":default:i=document.querySelector(i);break;case"all":i=document.querySelectorAll(i),t=!0;break;case"siblings":i=document.querySelector(i).parentNode.children,t=!0;break;case"parent":i=document.querySelector(i).parentNode;break;case"children":i=document.querySelector(selector).children,t=!0;break;case"closest":if(!a.closestValue)break;i=document.querySelector(i).closest(a.closestValue)}return{target:i,queryAll:t}}async getEventTargetElement(e,t,a,n,i){let s=!1,r=a.targetElement;const o=i.event?i.event:null;let l=o&&o.settings?o.settings.targetElement:null;switch(e){case"same":if(!t||!n)break;r=n.target;break;case"triggered":r="triggered";break;case"all":if(!t)break;r=document.querySelectorAll(l),s=!0;break;case"siblings":if(!t||!n)break;r=n.target.parentNode.children,s=!0;break;case"parent":if(!t||!n)break;r=n.target.parentNode;break;case"children":if(!t||!n)break;r=n.target.children,s=!0;break;case"closest":if(!t)break;if(!n)break;r=n.target.closest(r);break;case"querySelector":if(!t||!n)break;r=n.target.closest(l).querySelector(r);break;case"custom":r=document.querySelector(r);break;case"customAll":r=document.querySelectorAll(r),s=!0;break;case"window":r=window;break;default:if(!t)break;r=document.querySelector(l)}return{target:r,queryAll:s}}async runNode(e,t,a,n,i){let s,r,o=e.key,l=e.settings?e.settings:{};!!l.exceptTriggered&&l.exceptTriggered;if(l.target){const t=this.getTargetElement(l.target,l.targetElement,n,e,i);t&&(s=t[0],r=t[1])}switch(o){case"branch":{let s=null,r=e.inputs.find((e=>"condition"==e.key));r&&(s=r.id);let o=await this.getOppositePins(r,a);if(!o||0==o.length)return void console.error("No conditions found for condition node");let l=o[0],c=await this.getNodeFromPin(l,t);if(await this.handleNodeCondition(c,t,a)){let s=e.executionPins.true.id,r=await this.getOppositePins(s,a);if(!r||0==r.length)return;let o=r[0],l=await this.getNodeFromPin(o,t);if(!l)return;await this.runNode(l,t,a,n,i)}else{let s=e.executionPins.false.id,r=await this.getOppositePins(s,a);if(!r||0==r.length)return;let o=r[0],l=await this.getNodeFromPin(o,t);if(!l)return;await this.runNode(l,t,a,n,i)}return}case"delay":{let t=e.settings.delay?1e3*e.settings.delay:1e3;await this.wait(t);break}case"show":this.fireAction({action:"show",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"hide":this.fireAction({action:"hide",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"addClass":this.fireAction({action:"addClass",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"removeClass":this.fireAction({action:"removeClass",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"toggleClass":this.fireAction({action:"toggleClass",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"setAttribute":this.fireAction({action:"setAttribute",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"removeAttribute":this.fireAction({action:"removeAttribute",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"innerText":this.fireAction({action:"innerText",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"gsap":{if(!l.timelineAction||!l.timeline)return;"pageLoad"==this.currentRunningEvent&&await this.wait(0);let e=l.timelineAction,t=l.timeline,a=null!=l.timescale?l.timescale:1,n=!!l.playOnlyTriggeredElement&&l.playOnlyTriggeredElement,s=[];s=this.timelines.filter((e=>e.id==t)),n&&(s=s.filter((e=>{let t=[...i.target.getElementsByTagName("*")].includes(e.trigger),a=e.trigger.contains(i.target);return e.trigger==i.target||t||a})));const r=s.map((async t=>{let n=t.tl;if(1!=a&&n.timeScale(a),this.currentRunningEvent.includes("wpgb")){let e=n.getChildren();return n.clear(),e.forEach((e=>{let t=e.vars,a=(e.delay(),e.data.method),i=e._start,s=e.data.selector;switch(a){case"to":t.autoAlpha=1,n.to(s,{...t},i);break;case"from":t.autoAlpha=0,n.from(s,{...t},i);break;case"fromTo":t.autoAlpha=1,n.fromTo(s,{...t.startAt},{...t},i)}})),n.restart(),new Promise((e=>{n.eventCallback("onComplete",e)}))}return new Promise((t=>{switch(n.eventCallback("onComplete",t),e){case"play":n.play();break;case"pause":n.pause(),t();break;case"restart":n.restart();break;case"resume":n.resume();break;case"reverse":n.reverse();break;default:t()}}))}));await Promise.all(r);break}case"gsapFlip":this.fireAction({action:"gsapFlip",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"gsapSet":this.fireAction({action:"gsapSet",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"gsapFrom":this.fireAction({action:"gsapFrom",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"gsapTo":this.fireAction({action:"gsapTo",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"followCursor":this.fireAction({action:"followCursor",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"video_self_hosted_play":this.fireAction({action:"video_self_hosted_play",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"video_self_hosted_pause":this.fireAction({action:"video_self_hosted_pause",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"video_self_hosted_stop":this.fireAction({action:"video_self_hosted_stop",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"storageSetItem":this.fireAction({action:"storageSetItem",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"storageRemoveItem":this.fireAction({action:"storageRemoveItem",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"sessionStorageSetItem":this.fireAction({action:"sessionStorageSetItem",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"sessionStorageRemoveItem":this.fireAction({action:"sessionStorageRemoveItem",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"previousSlide":this.fireAction({action:"previousSlide",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"nextSlide":this.fireAction({action:"nextSlide",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"syncSliders":this.fireAction({action:"syncSliders",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"openPopup":this.fireAction({action:"openPopup",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"closePopup":this.fireAction({action:"closePopup",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"populateFormField":this.fireAction({action:"populateFormField",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"jsFunction":this.fireAction({action:"jsFunction",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"ajaxFunction":this.fireAction({action:"ajaxFunction",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"sendEmail":this.fireAction({action:"sendEmail",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"updateOption":this.fireAction({action:"updateOption",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"deleteOption":this.fireAction({action:"deleteOption",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0});break;case"makeConfetti":this.fireAction({action:"makeConfetti",selector:n,instance:e,actionData:e.settings,event:this.domContentLoadedEvent,actionDataRaw:null,isNode:!0});break;case"updateGlobalVariable":this.fireAction({action:"updateGlobalVariable",selector:n,instance:e,actionData:e.settings,event:i,actionDataRaw:null,isNode:!0})}this.checkForNextNode(e,t,a,n,i)}async checkForNextNode(e,t,a,n,i){let s=a.find((t=>t.fromNode==e.id));if(!s)return;let r=t.find((e=>e.id==s.toNode));await this.runNode(r,t,a,n,i)}async handleNodeCondition(e,t,a){let n=e.key,i=!1;switch(n){case"conditionGroup":{const n=e.settings?.relation||"and",s=(e.id,e.inputs||[]);if(!s.length){i=!1;break}let r=[];for(let e of s){if(!await this.getNodeFromPin(e.id,t))continue;const n=await this.getOppositePins(e.id,a);if(!n.length)continue;const i=await this.getNodeFromPin(n[0],t);if(i){const e=await this.handleNodeCondition(i,t,a);r.push(e)}}i="and"===n?r.every((e=>!0===e)):r.some((e=>!0===e));break}case"localStorageItemExists":case"sessionStorageItemExists":{let t=e.settings.name;if(!t){i=!1;break}("localStorageItemExists"==n?localStorage.getItem(t):sessionStorage.getItem(t))&&(i=!0);break}case"localStorageItemValueIs":case"sessionStorageItemValueIs":{let t=e.settings.name,a=e.settings.value,s=e.settings.operator?e.settings.operator:"equalTo";if(!t||!a){i=!1;break}let r="localStorageItemValueIs"==n?localStorage.getItem(t):sessionStorage.getItem(t);i=this.compareDefaultOperators(r,a,s);break}case"localStorageItemValueIncludes":case"sessionStorageItemValueIncludes":{let t=e.settings.name,a=e.settings.value,s=e.settings.operator?e.settings.operator:"exact";if(!t||!a){i=!1;break}let r="localStorageItemValueIncludes"==n?localStorage.getItem(t):sessionStorage.getItem(t);switch(s){case"exact":r&&r==a&&(i=!0);break;case"contains":r&&r.includes(a)&&(i=!0)}break}case"cookieExists":{let t=e.settings.name;if(!t){i=!1;break}document.cookie.split("; ").find((e=>e.startsWith(t)))&&(i=!0);break}case"cookieValueIs":{let t=e.settings.name,a=e.settings.value,n=e.settings.operator?e.settings.operator:"equalTo";if(!t||!a){i=!1;break}let s=document.cookie.split("; ").find((e=>e.split("=")[1]==a));i=this.compareDefaultOperators(s,a,n);break}case"cookieValueIncludes":{let t=e.settings.name,a=e.settings.value;if(!t||!a){i=!1;break}document.cookie.split("; ").find((e=>e.split("=")[1].includes(a)))&&(i=!0);break}case"urlIncludes":{let t=e.settings.value,a=e.settings.operator?e.settings.operator:"contains";if(!t){i=!1;break}let n=window.location.href;switch(a){case"contains":n.includes(t)&&(i=!0);break;case"exact":n==t&&(i=!0)}break}case"queryParamExists":{let t=e.settings.name;if(!t){i=!1;break}new URLSearchParams(window.location.search).has(t)&&(i=!0);break}case"queryParamValueIs":{let t=e.settings.name,a=e.settings.value,n=e.settings.operator?e.settings.operator:"equalTo";if(!t||!a){i=!1;break}let s=new URLSearchParams(window.location.search);if(s.has(t)){let e=s.get(t);i=this.compareDefaultOperators(e,a,n)}break}case"queryParamValueIncludes":{let t=e.settings.name,a=e.settings.value,n=e.settings.operator?e.settings.operator:"contains";if(!t||!a){i=!1;break}let s=new URLSearchParams(window.location.search);if(s.has(t)){let e=s.get(t);switch(n){case"contains":e.includes(a)&&(i=!0);break;case"exact":e===a&&(i=!0)}}break}case"windowWidth":{let t=e.settings.operator?e.settings.operator:"greaterThan",a=e.settings.value;if(!a){i=!1;break}let n=window.innerWidth;switch(t){case"greaterThan":n>a&&(i=!0);break;case"lessThan":n<a&&(i=!0);break;case"equalTo":n==a&&(i=!0)}break}case"windowHeight":{let t=e.settings.operator?e.settings.operator:"greaterThan",a=e.settings.value;if(!a){i=!1;break}let n=window.innerHeight;switch(t){case"greaterThan":n>a&&(i=!0);break;case"lessThan":n<a&&(i=!0);break;case"equalTo":n==a&&(i=!0)}break}case"elementExists":{let t=e.settings.selector;if(!t){i=!1;break}try{document.querySelector(t)&&(i=!0)}catch(e){i=!1}break}case"elementIsVisible":{let t=e.settings.selector;if(!t){i=!1;break}try{let e=document.querySelector(t);if(!e){i=!1;break}let a=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,s=window.innerWidth||document.documentElement.clientWidth,r=a.top<=n&&a.top+a.height>=0,o=a.left<=s&&a.left+a.width>=0,l="none"!==window.getComputedStyle(e).display;i=r&&o&&l}catch(e){console.error("Error checking element visibility:",e),i=!1}break}case"elementHasClass":{let t=e.settings.selector,a=e.settings.class;if(!t||!a){i=!1;break}try{let e=document.querySelector(t);if(!e){i=!1;break}e.className.includes(a)&&(i=!0)}catch(e){console.error("Error checking element class:",e),i=!1}break}case"elementHasAttribute":{let t=e.settings.selector,a=e.settings.attribute;if(!t||!a){i=!1;break}try{let e=document.querySelector(t);if(!e){i=!1;break}e.getAttribute(a)&&(i=!0)}catch(e){console.error("Error checking element attribute:",e),i=!1}break}case"elementAttributeIs":{let t=e.settings.selector,a=e.settings.attribute,n=e.settings.value,s=e.settings.operator?e.settings.operator:"equalTo";if(!t||!a||!n){i=!1;break}try{let e=document.querySelector(t);if(!e){i=!1;break}let r=e.getAttribute(a);i=this.compareDefaultOperators(r,n,s)}catch(e){i=!1}break}case"elementAttributeIncludes":{let t=e.settings.selector,a=e.settings.attribute,n=e.settings.value,s=e.settings.operator?e.settings.operator:"exact";if(!t||!a||!n){i=!1;break}try{let e=document.querySelector(t);if(!e){i=!1;break}let r=e.getAttribute(a);if(!r){i=!1;break}switch(s){case"exact":i=r===n;break;case"contains":i=r.includes(n);break;default:i=!1}}catch(e){console.error("Error checking element attribute includes:",e),i=!1}break}case"globalVariableExists":{let t=e.settings.name;if(!t){i=!1;break}window.bricksforgeData?.globalVariables?.[t]&&(i=!0);break}case"globalVariableIs":{let t=e.settings.name,a=e.settings.value,n=e.settings.operator?e.settings.operator:"equalTo";if(!t||!a){i=!1;break}i=this.compareDefaultOperators(window.bricksforgeData?.globalVariables?.[t],a,n);break}case"globalVariableValueIncludes":{let t=e.settings.name,a=e.settings.value;if(!t||!a){i=!1;break}window.bricksforgeData?.globalVariables?.[t]?.includes(a)&&(i=!0);break}}return i}compareDefaultOperators(e,t,a){let n=!1;const i=e=>parseFloat(e);switch(a){case"equalTo":n=e==t;break;case"greaterThan":n=i(e)>i(t);break;case"lessThan":n=i(e)<i(t);break;case"greaterThanOrEqualTo":n=i(e)>=i(t);break;case"lessThanOrEqualTo":n=i(e)<=i(t)}return n}async getOppositePins(e,t){let a=[],n="string"==typeof e?e:e.id;return t.filter((e=>e.from==n||e.to==n)).forEach((e=>{e.from==n?a.push(e.to):a.push(e.from)})),a}async getNodeFromPin(e,t){return t.find((t=>t.inputs&&t.inputs.find((t=>t.id==e))||t.outputs&&t.outputs.find((t=>t.id==e))||t.executionPins&&t.executionPins.in&&t.executionPins.in.id==e||t.executionPins&&t.executionPins.out&&t.executionPins.out.id==e||t.executionPins&&t.executionPins.true&&t.executionPins.true.id==e||t.executionPins&&t.executionPins.false&&t.executionPins.false.id==e))}}function brfPanelHandleEarlyInstances(){if(!BRFPANEL||!BRFPANEL.panel||0==BRFPANEL.panel.length)return;let e=BRFPANEL.panel[0].instances;if(!e||0==e.length)return;const t=[],a=[];let n=e.filter((e=>"document"==e.selector&&!e.disabled||1==e.early||t.includes(e.event)||a.includes(e.event)));n&&0!=n.length&&n.forEach((e=>{if(a.includes(e.event))return void document.addEventListener("DOMContentLoaded",(()=>{new BricksforgePanel(null,!0).handleInstance(e)}));new BricksforgePanel(null,!0).handleInstance(e)}))}document.addEventListener("DOMContentLoaded",(e=>{brfPanel=new BricksforgePanel(e)})),brfPanelHandleEarlyInstances()